<!DOCTYPE html>
<html lang="en">

<head>
    <base href="/tanka-graphql/">
    <title>14-link-directive - Tanka GraphQL</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Noto Color Emoji font for cross-platform emoji support -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    
    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

    <style>
        :root {
            --bs-body-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif;
            --bs-link-color-rgb: 8, 87, 168;
            --bs-link-hover-color-rgb: 6, 68, 130;
        }

        body {
            font-family: var(--bs-body-font-family);
        }

        .sidebar {
            position: sticky;
            top: 56px; /* Height of navbar */
            height: calc(100vh - 56px);
            overflow-y: auto;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
            padding-top: 1rem;
        }

        /* Mobile sidebar improvements */
        @media (max-width: 767.98px) {
            .sidebar {
                position: fixed;
                top: 56px;
                left: 0;
                width: 100%;
                height: calc(100vh - 56px);
                z-index: 1040;
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
            
            .sidebar.collapse:not(.show) {
                display: none;
            }
            
            .sidebar.collapsing,
            .sidebar.collapse.show {
                display: block;
            }
        }

        .toc-sidebar {
            position: sticky;
            top: 56px; /* Height of navbar */
            height: calc(100vh - 56px);
            overflow-y: auto;
            padding-top: 1rem;
        }

        /* Mobile TOC styling - single responsive TOC */
        @media (max-width: 991.98px) {
            .toc-sidebar {
                position: static !important;
                height: auto !important;
                max-height: 300px;
                overflow-y: auto;
                background-color: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 0.375rem;
                margin-bottom: 1rem;
                padding: 1rem;
                /* Move TOC to mobile position - above content */
                order: -1;
                display: block !important; /* Override Bootstrap d-none d-lg-block */
            }

            .toc-sidebar.collapsed {
                display: none !important;
            }

            .toc-sidebar .toc-title {
                display: none; /* Hide desktop title on mobile */
            }

            /* Adjust main content layout for mobile */
            .content {
                order: 0;
            }
        }

        .toc-toggle {
            display: none;
        }

        @media (max-width: 991.98px) {
            .toc-toggle {
                display: inline-block;
            }
        }

        .sidebar .nav-link {
            font-size: 0.9rem;
            color: #495057;
        }

        .sidebar .nav-link.active, .sidebar .nav-link:hover {
            color: rgb(var(--bs-link-color-rgb));
            font-weight: 500;
        }

        /* Ensure emojis render properly in navigation */
        .sidebar .nav-link {
            font-feature-settings: "liga" on, "clig" on;
            text-rendering: optimizeLegibility;
            font-family: var(--bs-body-font-family);
        }
        
        .toc-sidebar .nav-link {
            font-size: 0.8rem;
            color: #6c757d;
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
        }

        .toc-sidebar .nav-link:hover {
            color: #212529;
        }

        .toc-sidebar .nav-link.active {
            font-weight: 600;
            color: #212529; /* Darker text for readability */
            border-left: 2px solid rgb(var(--bs-link-color-rgb));
        }

        blockquote {
            font-size: 1rem;
            border-left: 4px solid #adb5bd;
            padding-left: 1rem;
            color: #6c757d;
        }

        .content h1, .content h2, .content h3, .content h4, .content h5, .content h6 {
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .content h2, .content h3 {
            scroll-margin-top: 80px;
        }

        /* Adjust code block styling to match highlight.js theme */
        pre code.hljs {
            border-radius: 0.3rem;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Tanka GraphQL</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="main/index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="main/0-getting-started/00-getting-started.html">Getting Started</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="main/10-extensions/tracing.html">Extensions</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="main/2-language/01-parser.html">Language</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="main/3-server/00-index.html">Server</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="main/4-code-generator/01-samples-sg-basic.html">Code Generation</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="main/6-executor/01-executor.html">Executor</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="main/7-type-system/02-schema.html">Type System</a>
                        </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/pekkah/tanka-graphql" target="_blank" rel="noopener">GitHub</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            main
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                                <li><a class="dropdown-item" href="/tanka-graphql/main">main</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
    <nav class="nav flex-column">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/02-schema.html>Schema</a>
        <a class="btn btn-sm" data-bs-toggle="collapse" href="#nav-02-schema.md" role="button" aria-expanded="false" aria-controls="nav-02-schema.md">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>
        </a>
    </div>
    <div class="collapse" id="nav-02-schema.md">
        <ul class="nav flex-column ms-3">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/01_1-builder.html>SchemaBuilder</a>
    </div>
</li><li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/01_2-executablebuilder.html>ExecutableSchemaBuilder</a>
    </div>
</li><li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/03-middleware.html>Middleware</a>
    </div>
</li>        </ul>
    </div>
</li>    </nav>
    <nav class="nav flex-column">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/04-types.html>Types</a>
        <a class="btn btn-sm" data-bs-toggle="collapse" href="#nav-04-types.md" role="button" aria-expanded="false" aria-controls="nav-04-types.md">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>
        </a>
    </div>
    <div class="collapse" id="nav-04-types.md">
        <ul class="nav flex-column ms-3">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/05-scalars.html>Scalars</a>
    </div>
</li><li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/06-objects.html>Objects</a>
    </div>
</li><li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/07-interfaces.html>Interfaces</a>
    </div>
</li><li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/08-unions.html>Unions</a>
    </div>
</li><li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/09-enums.html>Enums</a>
    </div>
</li><li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/10-input-objects.html>Input Objects</a>
    </div>
</li>        </ul>
    </div>
</li>    </nav>
    <nav class="nav flex-column">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/13-directives.html>Directives</a>
        <a class="btn btn-sm" data-bs-toggle="collapse" href="#nav-13-directives.md" role="button" aria-expanded="false" aria-controls="nav-13-directives.md">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>
        </a>
    </div>
    <div class="collapse" id="nav-13-directives.md">
        <ul class="nav flex-column ms-3">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/14-link-directive.html>@link</a>
    </div>
</li>        </ul>
    </div>
</li>    </nav>
    <nav class="nav flex-column">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/6-introspection/5-schema.html>Introspection</a>
        <a class="btn btn-sm" data-bs-toggle="collapse" href="#nav-6-introspection/5-schema.md" role="button" aria-expanded="false" aria-controls="nav-6-introspection/5-schema.md">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>
        </a>
    </div>
    <div class="collapse" id="nav-6-introspection/5-schema.md">
        <ul class="nav flex-column ms-3">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=main/7-type-system/6-introspection/4-type-name.html>Type name</a>
    </div>
</li>        </ul>
    </div>
</li>    </nav>
            </nav>
            <main class="col-md-6 ms-sm-auto col-lg-7 px-md-4 py-3 content d-flex flex-column">
                <!-- Mobile navigation buttons -->
                <div class="d-md-none mb-3">
                    <button id="sidebar-toggle" class="btn btn-outline-primary btn-sm me-2" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar" aria-expanded="false" aria-controls="sidebar">
                        <svg width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                        <span class="ms-1">Menu</span>
                    </button>
                    <button id="toc-toggle" class="btn btn-outline-secondary btn-sm toc-toggle" type="button">
                        <svg width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                        <span class="ms-1">On this page</span>
                    </button>
                </div>
                <h2 id="link-directive">@link Directive</h2>
<p>The <code>@link</code> directive enables schema composition by importing types and directives from external schemas. This powerful feature allows you to build modular GraphQL schemas and is the foundation for specifications like Apollo Federation.</p>
<h3 id="overview">Overview</h3>
<p>The <code>@link</code> directive is applied to the schema definition and allows you to:</p>
<ul>
<li>Import types and directives from external schema specifications</li>
<li>Use type aliasing to avoid naming conflicts</li>
<li>Compose schemas from multiple sources</li>
<li>Enable federation and other advanced GraphQL patterns</li>
</ul>
<p>Tanka GraphQL provides complete support for the <code>@link</code> directive including:</p>
<ul>
<li>✅ Basic imports by name</li>
<li>✅ Type and directive aliasing</li>
<li>✅ Namespace prefixing with <code>as</code> parameter</li>
<li>✅ Mixed aliased and non-aliased imports</li>
<li>✅ Custom schema loaders</li>
<li>✅ Circular reference protection</li>
<li>✅ Integration with Apollo Federation</li>
</ul>
<h3 id="basic-usage">Basic Usage</h3>
<pre><code>[Fact]
public async Task BasicLinkUsage()
{
    var schema = &quot;&quot;&quot;
        extend schema @link(
          url: &quot;https://mycompany.com/schemas/auth/v1.0&quot;,
          import: [&quot;@authenticated&quot;, &quot;@authorized&quot;, &quot;Role&quot;]
        )

        type Query {
          profile: User @authenticated
          admin: AdminPanel @authorized(role: ADMIN)
        }

        type User {
            id: ID!
            name: String
        }

        type AdminPanel {
            settings: String
        }
        &quot;&quot;&quot;;

    var builtSchema = await new SchemaBuilder()
        .Add(schema)
        .Build(options =&gt;
        {
            options.SchemaLoader = new CustomSchemaLoader();
        });

    Assert.NotNull(builtSchema);
    Assert.NotNull(builtSchema.GetNamedType(&quot;User&quot;));
    Assert.NotNull(builtSchema.GetDirectiveType(&quot;authenticated&quot;));
    Assert.NotNull(builtSchema.GetNamedType(&quot;Role&quot;)); // Imported from external schema
}
</code></pre>
<h3 id="syntax">Syntax</h3>
<p>The <code>@link</code> directive follows the GraphQL specification for schema composition:</p>
<ul>
<li><strong>url</strong> (required): The URL of the specification to import from</li>
<li><strong>as</strong>: Namespace prefix for imported types (e.g., <code>federation</code> would prefix types as <code>federation__Type</code>)</li>
<li><strong>import</strong>: List of specific types and directives to import</li>
<li><strong>for</strong>: Purpose of the link (SECURITY or EXECUTION)</li>
</ul>
<h3 id="import-syntax">Import Syntax</h3>
<p>The <code>import</code> parameter accepts several formats:</p>
<h4 id="simple-import">Simple Import</h4>
<p>Import types and directives by name using string literals.</p>
<h4 id="import-with-aliasing">Import with Aliasing</h4>
<p>Rename imported types to avoid conflicts.</p>
<pre><code>[Fact]
public async Task ImportWithAliasing()
{
    var schema = &quot;&quot;&quot;
        extend schema @link(
          url: &quot;https://mycompany.com/schemas/auth/v1.0&quot;,
          import: [
            { name: &quot;@authenticated&quot;, as: &quot;@requiresAuth&quot; },
            { name: &quot;Role&quot;, as: &quot;UserRole&quot; }
          ]
        )

        type Query {
            profile: User
            admin: AdminPanel
        }

        type User {
            id: ID!
            name: String
        }

        type AdminPanel {
            settings: String
        }
        &quot;&quot;&quot;;

    var builtSchema = await new SchemaBuilder()
        .Add(schema)
        .Build(options =&gt;
        {
            options.SchemaLoader = new CustomSchemaLoader();
        });

    Assert.NotNull(builtSchema);
    Assert.NotNull(builtSchema.GetNamedType(&quot;User&quot;));

    // Verify that aliasing worked correctly
    Assert.NotNull(builtSchema.GetDirectiveType(&quot;requiresAuth&quot;)); // Aliased directive
    Assert.NotNull(builtSchema.GetNamedType(&quot;UserRole&quot;)); // Aliased type
    Assert.Null(builtSchema.GetDirectiveType(&quot;authenticated&quot;)); // Original should not exist
    Assert.Null(builtSchema.GetNamedType(&quot;Role&quot;)); // Original should not exist
}
</code></pre>
<h3 id="how-it-works">How It Works</h3>
<p>The <code>@link</code> directive is processed by the <code>LinkProcessingMiddleware</code> during schema building:</p>
<ol>
<li><strong>Directive Discovery</strong>: @link directives are extracted from schema definitions and extensions</li>
<li><strong>URL Resolution</strong>: The URL is resolved to determine the appropriate schema loader</li>
<li><strong>Schema Loading</strong>: The schema loader fetches the external specification</li>
<li><strong>Import Parsing</strong>: Import specifications are parsed, including aliases</li>
<li><strong>Import Filtering</strong>: Only the specified imports (or all if none specified) are included</li>
<li><strong>Type Aliasing</strong>: Imported types and directives are renamed according to aliases</li>
<li><strong>Schema Merging</strong>: Imported types are merged into your schema</li>
<li><strong>Conflict Detection</strong>: Ensures no naming conflicts occur</li>
</ol>
<p>This process supports recursive linking with circular reference protection and maintains type safety throughout the composition process.</p>
<h3 id="schema-loaders">Schema Loaders</h3>
<p>Tanka GraphQL includes built-in schema loaders:</p>
<h4 id="federationschemaloader">FederationSchemaLoader</h4>
<p>Handles Apollo Federation specifications:</p>
<pre><code class="language-csharp">// Automatically configured when using Federation
options.SchemaLoader = new FederationSchemaLoader();
</code></pre>
<h4 id="httpschemaloader">HttpSchemaLoader</h4>
<p>Loads schemas from HTTP endpoints:</p>
<pre><code class="language-csharp">options.SchemaLoader = new HttpSchemaLoader();
</code></pre>
<h4 id="compositeschemaloader">CompositeSchemaLoader</h4>
<p>Chains multiple loaders:</p>
<pre><code class="language-csharp">options.SchemaLoader = new CompositeSchemaLoader(
    new FederationSchemaLoader(),
    new HttpSchemaLoader()
);
</code></pre>
<h3 id="examples">Examples</h3>
<h4 id="importing-federation-types">Importing Federation Types</h4>
<pre><code>[Fact]
public async Task ImportingCustomTypes()
{
    var schema = &quot;&quot;&quot;
        extend schema @link(
          url: &quot;https://mycompany.com/schemas/validation/v1.0&quot;,
          import: [&quot;@length&quot;, &quot;@range&quot;, &quot;@email&quot;, &quot;@unique&quot;]
        )

        type User {
          id: ID!
          email: String @email @unique
          name: String @length(min: 2, max: 50)
          age: Int @range(min: 13, max: 120)
        }

        type Query {
            user(id: ID!): User
        }
        &quot;&quot;&quot;;

    var builtSchema = await new SchemaBuilder()
        .Add(schema)
        .Build(options =&gt;
        {
            options.SchemaLoader = new ValidationSchemaLoader();
        });

    Assert.NotNull(builtSchema);
    Assert.NotNull(builtSchema.GetDirectiveType(&quot;length&quot;));
    Assert.NotNull(builtSchema.GetDirectiveType(&quot;range&quot;));
    Assert.NotNull(builtSchema.GetDirectiveType(&quot;email&quot;));
    Assert.NotNull(builtSchema.GetDirectiveType(&quot;unique&quot;));
}
</code></pre>
<h4 id="using-namespaces">Using Namespaces</h4>
<pre><code>[Fact]
public async Task UsingNamespaces()
{
    var schema = &quot;&quot;&quot;
        extend schema @link(
          url: &quot;https://mycompany.com/schemas/auth/v1.0&quot;,
          as: &quot;auth&quot;
        )

        type Query {
          profile: User @auth__authenticated
          admin: AdminPanel @auth__authorized(role: auth__ADMIN)
        }

        type User {
            id: ID!
            name: String
        }

        type AdminPanel {
            settings: String
        }
        &quot;&quot;&quot;;

    var builtSchema = await new SchemaBuilder()
        .Add(schema)
        .Build(options =&gt;
        {
            options.SchemaLoader = new CustomSchemaLoader();
        });

    Assert.NotNull(builtSchema);
    Assert.NotNull(builtSchema.GetNamedType(&quot;User&quot;));
    // Note: Namespace prefixing implementation may need verification
}
</code></pre>
<h4 id="custom-specifications">Custom Specifications</h4>
<p>You can import from your own specifications:</p>
<pre><code>[Fact]
public async Task CustomSpecifications()
{
    var schema = &quot;&quot;&quot;
        extend schema @link(
          url: &quot;https://mycompany.com/schemas/auth/v1.0&quot;,
          import: [&quot;@authenticated&quot;, &quot;@authorized&quot;, &quot;Role&quot;]
        )

        type Query {
          profile: User @authenticated
          admin: AdminPanel @authorized(role: ADMIN)
        }

        type User {
            id: ID!
            name: String
        }

        type AdminPanel {
            settings: String
        }

        enum Role {
            USER
            ADMIN
        }
        &quot;&quot;&quot;;

    // Note: This would require a custom schema loader for the auth specification
    var builtSchema = await new SchemaBuilder()
        .Add(schema)
        .Build();

    Assert.NotNull(builtSchema);
    Assert.NotNull(builtSchema.GetNamedType(&quot;User&quot;));
    Assert.NotNull(builtSchema.GetNamedType(&quot;AdminPanel&quot;));
}
</code></pre>
<h3 id="creating-custom-schema-loaders">Creating Custom Schema Loaders</h3>
<p>Implement <code>ISchemaLoader</code> to load schemas from custom sources:</p>
<pre><code>[Fact]
public void CustomSchemaLoaderExample()
{
    // Example of implementing a custom schema loader
    var customLoader = new CustomSchemaLoader();

    var options = new SchemaBuildOptions();
    options.SchemaLoader = new CompositeSchemaLoader(
        customLoader,
        new HttpSchemaLoader()
    );

    // Verify the loader chain is set up correctly
    Assert.NotNull(options.SchemaLoader);
    Assert.IsType&lt;CompositeSchemaLoader&gt;(options.SchemaLoader);
}
</code></pre>
<h3 id="processing-pipeline">Processing Pipeline</h3>
<p>The <code>@link</code> directive is processed by the <code>LinkProcessingMiddleware</code> during schema building:</p>
<ol>
<li><strong>Initialization Stage</strong>: Basic schema setup</li>
<li><strong>Type Collection</strong>: Gather type definitions</li>
<li><strong>Link Processing Stage</strong>:
<ul>
<li>Process all <code>@link</code> directives</li>
<li>Load external schemas</li>
<li>Apply import filtering</li>
<li>Handle type aliasing</li>
<li>Merge imported types</li>
</ul>
</li>
<li><strong>Type Resolution</strong>: Configure resolvers</li>
<li><strong>Validation</strong>: Validate complete schema</li>
<li><strong>Finalization</strong>: Create executable schema</li>
</ol>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li><p><strong>Be Specific with Imports</strong>: Only import what you need to avoid namespace pollution</p>
<p>[Fact]
public async Task SpecificImportsBestPractice()
{
// Best practice: Be specific with imports to avoid namespace pollution
var schema = &quot;&quot;&quot;
extend schema @link(
url: &quot;https://mycompany.com/schemas/auth/v1.0&quot;,
import: [&quot;@authenticated&quot;, &quot;@authorized&quot;]  # Only import what you need
)</p>
<pre><code>     type Query {
         profile: User @authenticated
         admin: AdminPanel @authorized(role: ADMIN)
     }

     type User {
         id: ID!
         name: String
     }

     type AdminPanel {
         settings: String
     }

     enum Role {
         USER
         ADMIN
     }
     &quot;&quot;&quot;;

 var builtSchema = await new SchemaBuilder()
     .Add(schema)
     .Build(options =&gt;
     {
         options.SchemaLoader = new CustomSchemaLoader();
     });

 Assert.NotNull(builtSchema);
 Assert.NotNull(builtSchema.GetDirectiveType(&quot;authenticated&quot;));
 Assert.NotNull(builtSchema.GetDirectiveType(&quot;authorized&quot;));
 // @notused should NOT be available since it wasn't imported (even though it exists in the loaded schema)
 Assert.Null(builtSchema.GetDirectiveType(&quot;notused&quot;));
</code></pre>
<p>}</p>
</li>
<li><p><strong>Use Aliasing for Conflicts</strong>: When importing from multiple sources, use aliases to avoid naming conflicts</p>
</li>
<li><p><strong>Version Your Specifications</strong>: Include version numbers in URLs for stability</p>
<p>[Fact]
public async Task VersionedSpecificationsBestPractice()
{
// Best practice: Include version numbers in URLs for stability
var schema = &quot;&quot;&quot;
extend schema @link(
url: &quot;https://mycompany.com/schemas/auth/v1.0&quot;,  # Specific version
import: [&quot;@authenticated&quot;]
)</p>
<pre><code>     type Query {
         profile: User @authenticated
     }

     type User {
         id: ID!
         name: String
     }
     &quot;&quot;&quot;;

 var builtSchema = await new SchemaBuilder()
     .Add(schema)
     .Build(options =&gt;
     {
         options.SchemaLoader = new CustomSchemaLoader();
     });

 Assert.NotNull(builtSchema);
 Assert.NotNull(builtSchema.GetDirectiveType(&quot;authenticated&quot;));
</code></pre>
<p>}</p>
</li>
<li><p><strong>Cache External Schemas</strong>: Implement caching in custom loaders for performance</p>
</li>
<li><p><strong>Validate Imports</strong>: Ensure imported types are used correctly in your schema</p>
</li>
</ol>
<h3 id="troubleshooting">Troubleshooting</h3>
<h4 id="common-issues">Common Issues</h4>
<ul>
<li><strong>Schema not loading</strong>: Verify the URL is accessible and the schema loader is configured</li>
<li><strong>Type conflicts</strong>: Use aliasing or namespaces to resolve naming conflicts</li>
<li><strong>Missing imports</strong>: Check that all required types are included in the import list</li>
<li><strong>Circular dependencies</strong>: Avoid schemas that link to each other recursively</li>
</ul>
<h4 id="debugging">Debugging</h4>
<p>Enable debug logging to trace @link processing by configuring logging at the Debug level in your application.</p>
<h3 id="limitations">Limitations</h3>
<ul>
<li>Recursive linking depth is limited to prevent infinite loops</li>
<li>Schema loaders must return valid GraphQL SDL</li>
<li>Imported types must not conflict with existing types unless aliasing is used</li>
</ul>
<h3 id="see-also">See Also</h3>
<ul>
<li>xref:types:03-middleware.md[Middleware Pipeline] - How @link processing fits in the build pipeline</li>
<li>xref:extensions:apollo-federation.md[Apollo Federation] - Using @link for federation</li>
<li>xref:types:01_1-builder.md[Schema Builder] - Configuring schema loaders</li>
</ul>

            </main>
            <!-- Single responsive TOC -->
            <nav id="toc" class="col-md-3 col-lg-3 d-none d-lg-block toc-sidebar collapsed">
                <strong class="d-block h6 my-2 pb-2 border-bottom toc-title">On this page</strong>
                <nav class="nav flex-column"></nav>
            </nav>
        </div>
    </div>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- Highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

    <script>
        (function() {

            // Left sidebar active link and mobile navigation
            const sidebar = document.querySelector('.sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const MOBILE_BREAKPOINT = 768;
            
            if (sidebar) {
                const baseHref = document.baseURI;
                const currentPageHref = window.location.href.split('#')[0]; // Ignore hash
                let currentPagePath = currentPageHref.substring(baseHref.length);

                if (currentPagePath.endsWith('/')) {
                    currentPagePath = currentPagePath.slice(0, -1);
                }

                const navLinks = sidebar.querySelectorAll('a.nav-link');
                navLinks.forEach(link => {
                    const linkHref = link.getAttribute('href');
                    if (linkHref && (linkHref === currentPagePath || linkHref === currentPagePath + '/index.html')) {
                        link.classList.add('active');

                        let parentCollapse = link.closest('.collapse');
                        while(parentCollapse) {
                            parentCollapse.classList.add('show');
                            const trigger = document.querySelector(`a[data-bs-toggle="collapse"][href="#${parentCollapse.id}"]`);
                            if (trigger) {
                                trigger.setAttribute('aria-expanded', 'true');
                                trigger.classList.remove('collapsed');
                            }
                            parentCollapse = parentCollapse.parentElement.closest('.collapse');
                        }
                    }
                    
                    // Auto-close sidebar on mobile when navigation link is clicked
                    link.addEventListener('click', () => {
                        if (window.innerWidth < MOBILE_BREAKPOINT && sidebar.classList.contains('show')) {
                            const bsCollapse = new bootstrap.Collapse(sidebar, {
                                toggle: false
                            });
                            bsCollapse.hide();
                        }
                    });
                });
            }

            // "On this page" TOC script - single responsive TOC
            const toc = document.getElementById('toc');
            const tocToggle = document.getElementById('toc-toggle');
            
            // Constants
            const SCROLL_OFFSET = 100;
            const SCROLL_THROTTLE_MS = 25; // Optimized from 10ms
            const SCROLL_NAVIGATION_TIMEOUT_MS = 200;
            const MOBILE_BREAKPOINT = 992;
            
            if (toc) {
                const mainContent = document.querySelector('.content');
                if (!mainContent) return;
                
                const headings = mainContent.querySelectorAll('h2, h3');
                const tocNav = toc.querySelector('.nav');
                
                if (!tocNav) return;
                
                if (headings.length > 0) {
                    let isScrolling = false;
                    
                    // Create TOC links
                    headings.forEach((heading, index) => {
                        const id = 'heading-' + index;
                        if (!heading.getAttribute('id')) {
                            heading.setAttribute('id', id);
                        }

                        const link = document.createElement('a');
                        link.classList.add('nav-link');
                        if (heading.tagName === 'H3') {
                            link.classList.add('ms-3'); // Indent H3
                        }
                        
                        const href = '#' + id;
                        link.setAttribute('href', href);
                        link.textContent = heading.textContent;

                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            
                            // Temporarily disable scroll tracking during navigation
                            isScrolling = true;
                            
                            // Remove active class from all TOC links
                            tocNav.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                            
                            // Add active class to clicked link
                            link.classList.add('active');
                            
                            // On mobile, collapse the TOC after clicking a link
                            if (window.innerWidth < MOBILE_BREAKPOINT && toc) {
                                toc.classList.add('collapsed');
                                if (tocToggle) {
                                    updateToggleButton(true);
                                }
                            }
                            
                            // Navigate to the hash
                            window.location.hash = href;
                            
                            // Re-enable scroll tracking after navigation completes
                            let scrollTimeout;
                            const handleScroll = () => {
                                clearTimeout(scrollTimeout);
                                scrollTimeout = setTimeout(() => {
                                    window.removeEventListener('scroll', handleScroll);
                                    isScrolling = false;
                                }, SCROLL_NAVIGATION_TIMEOUT_MS);
                            };
                            
                            window.addEventListener('scroll', handleScroll);
                            
                            // Fallback: re-enable after 1 second
                            setTimeout(() => {
                                window.removeEventListener('scroll', handleScroll);
                                isScrolling = false;
                            }, 1000);
                        });
                        
                        tocNav.appendChild(link);
                    });

                    // Update toggle button appearance
                    const updateToggleButton = (isCollapsed) => {
                        if (!tocToggle) return;
                        
                        if (isCollapsed) {
                            tocToggle.innerHTML = `<svg width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                            </svg><span class="ms-1">On this page</span>`;
                        } else {
                            tocToggle.innerHTML = `<svg width="16" height="16" fill="currentColor" class="bi bi-chevron-up" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
                            </svg><span class="ms-1">Hide</span>`;
                        }
                    };

                    // Set initial active state based on current scroll position or hash
                    const setInitialActiveState = () => {
                        const hash = window.location.hash;
                        if (hash && tocNav) {
                            const targetLink = tocNav.querySelector(`a[href="${hash}"]`);
                            if (targetLink) {
                                tocNav.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                                targetLink.classList.add('active');
                                return;
                            }
                        }
                        
                        // Find the currently visible heading
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        let activeHeading = null;
                        
                        for (let i = 0; i < headings.length; i++) {
                            const heading = headings[i];
                            const rect = heading.getBoundingClientRect();
                            const headingTop = rect.top + scrollTop;
                            
                            if (headingTop <= scrollTop + SCROLL_OFFSET) {
                                activeHeading = heading;
                            } else {
                                break;
                            }
                        }
                        
                        if (activeHeading && tocNav) {
                            const activeId = activeHeading.getAttribute('id');
                            const activeLink = tocNav.querySelector(`a[href="#${activeId}"]`);
                            if (activeLink) {
                                tocNav.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                                activeLink.classList.add('active');
                            }
                        } else if (tocNav) {
                            // If no heading is visible, activate the first one
                            const firstLink = tocNav.querySelector('.nav-link');
                            if (firstLink) {
                                firstLink.classList.add('active');
                            }
                        }
                    };

                    // Set initial active state
                    setInitialActiveState();

                    // Optimized scroll tracking
                    const updateActiveOnScroll = () => {
                        if (isScrolling || !tocNav) return;
                        
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        let activeHeading = null;
                        
                        for (let i = 0; i < headings.length; i++) {
                            const heading = headings[i];
                            const rect = heading.getBoundingClientRect();
                            const headingTop = rect.top + scrollTop;
                            
                            if (headingTop <= scrollTop + SCROLL_OFFSET) {
                                activeHeading = heading;
                            } else {
                                break;
                            }
                        }
                        
                        const currentActiveLink = tocNav.querySelector('.nav-link.active');
                        let newActiveLink = null;
                        
                        if (activeHeading) {
                            const activeId = activeHeading.getAttribute('id');
                            newActiveLink = tocNav.querySelector(`a[href="#${activeId}"]`);
                        } else {
                            newActiveLink = tocNav.querySelector('.nav-link');
                        }
                        
                        if (newActiveLink && newActiveLink !== currentActiveLink) {
                            tocNav.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                            newActiveLink.classList.add('active');
                        }
                    };
                    
                    // Throttled scroll listener
                    let scrollTimeout;
                    window.addEventListener('scroll', () => {
                        clearTimeout(scrollTimeout);
                        scrollTimeout = setTimeout(updateActiveOnScroll, SCROLL_THROTTLE_MS);
                    });

                    // Mobile TOC toggle functionality
                    if (tocToggle) {
                        tocToggle.addEventListener('click', () => {
                            const isCollapsed = toc.classList.contains('collapsed');
                            if (isCollapsed) {
                                toc.classList.remove('collapsed');
                                updateToggleButton(false);
                            } else {
                                toc.classList.add('collapsed');
                                updateToggleButton(true);
                            }
                        });
                    }
                } else {
                    // Hide TOC if no headings
                    toc.style.display = 'none';
                    if (tocToggle) tocToggle.style.display = 'none';
                }
            }

            if (window.location.hostname !== 'localhost') {
                return;
            }
            // Live reload script
            const port = window.location.port || (window.location.protocol === 'https:' ? '443' : '80');
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const socketUrl = `${protocol}//${window.location.hostname}:${port}/ws`;
            let socket;

            function connect() {
                socket = new WebSocket(socketUrl);
                socket.addEventListener('open', () => { console.log('Live reload connected.'); });
                socket.addEventListener('message', (event) => {
                    if (event.data === 'reload') {
                        console.log('Reloading page...');
                        window.location.reload();
                    }
                });
                socket.addEventListener('close', () => {
                    console.log('Live reload disconnected. Trying to reconnect in 2 seconds...');
                    setTimeout(connect, 2000);
                });
                socket.addEventListener('error', (err) => {
                    console.error('Live reload error:', err);
                    socket.close();
                });
            }
            connect();
        })();
    </script>
</body>
</html>